<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon Says Game</title>
    <style>
        body {
            text-align: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s;
            background-color: #f4f4f4;
            color: #333;
        }

        h1 {
            font-size: 3rem;
            margin: 20px 0;
        }

        h2 {
            font-size: 1.5rem;
            margin: 10px 0;
        }

        .scoreboard {
            font-size: 1.1rem;
            margin: 10px 0;
        }

        .btn {
            height: 150px;
            width: 150px;
            border: 5px solid black;
            border-radius: 20%;
            margin: 0.7rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            transition: all 0.2s;
        }

        .btn-container {
            display: flex;
            flex-direction: column;
            margin: 20px;
        }

        .line-one, .line-two {
            display: flex;
            justify-content: center;
        }

        .col1 { background-color:#9ECAD6; }
        .col2 { background-color:#748DAE; }
        .col3 { background-color:#F5CBCB; }
        .col4 { background-color:#687FE5; }

        .gameFlash {
            background-color: white !important;
        }

        .userFlash {
            box-shadow: 0 0 20px 5px green;
            background-color: green !important;
        }

        .dark-mode {
            background-color: #222;
            color: white;
        }

        .dark-mode .btn {
            border-color: white;
        }

        #darkModeToggle {
            margin: 10px;
            padding: 8px 16px;
            background-color: #444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.3s;
        }

        #darkModeToggle:hover {
            background-color: #222;
        }
    </style>
</head>
<body>
    <h1>Simon Says Game</h1>
    <h2>Press any key to start the Game</h2>
    <div class="scoreboard">
        Current Score: <span id="currentScore">0</span> | High Score: <span id="highScore">0</span>
    </div>
    <button id="darkModeToggle">Toggle Dark Mode</button>

    <div class="btn-container">
        <div class="line-one">
            <div class="btn col1" id="col1">1</div>
            <div class="btn col2" id="col2">2</div>
        </div>
        <div class="line-two">
            <div class="btn col3" id="col3">3</div>
            <div class="btn col4" id="col4">4</div>
        </div>
    </div>

    <script>
        let gameSeq = [];
        let userSeq = [];
        let started = false;
        let level = 0;
        let highScore = localStorage.getItem('simonHighScore') || 0;

        const h2 = document.querySelector("h2");
        const currentScoreDisplay = document.getElementById('currentScore');
        const highScoreDisplay = document.getElementById('highScore');
        highScoreDisplay.textContent = highScore;

        const btns = ["col1","col2","col3","col4"];

        document.addEventListener("keypress", function(){
            if (!started) {
                started = true;
                levelUP();
            }
        });

        document.getElementById("darkModeToggle").addEventListener("click", function(){
            document.body.classList.toggle("dark-mode");
        });

        function playSound(color) {
            let audio = new Audio(`sounds/${color}.mp3`);
            audio.play();
        }

        function gameFlash(btn) {
            btn.classList.add("gameFlash");
            playSound(btn.id);
            setTimeout(() => btn.classList.remove("gameFlash"), 300);
        }

        function userFlash(btn) {
            btn.classList.add("userFlash");
            playSound(btn.id);
            setTimeout(() => btn.classList.remove("userFlash"), 300);
        }

        function levelUP() {
            userSeq = [];
            level++;
            updateScore();
            h2.innerText = `Level ${level}`;
            let randIdx = Math.floor(Math.random() * 4);
            let randColor = btns[randIdx];
            let randBtn = document.querySelector(`#${randColor}`);
            gameSeq.push(randColor);
            gameFlash(randBtn);
        }

        function updateScore() {
            currentScoreDisplay.textContent = level;
            if (level > highScore) {
                highScore = level;
                highScoreDisplay.textContent = highScore;
                localStorage.setItem('simonHighScore', highScore);
            }
        }

        function checkAns(idx) {
            if (userSeq[idx] === gameSeq[idx]) {
                if (userSeq.length === gameSeq.length) {
                    setTimeout(levelUP, 1000);
                }
            } else {
                let wrongAudio = new Audio("sounds/wrong.mp3");
                wrongAudio.play();
                h2.innerHTML = `Game Over! Your Score was <b>${level}</b> <br> Press any key to start again!`;
                document.body.style.backgroundColor = "red";
                setTimeout(() => document.body.style.backgroundColor = "", 150);
                reset();
            }
        }

        function btnPress() {
            let btn = this;
            userFlash(btn);
            let userColor = btn.getAttribute("id");
            userSeq.push(userColor);
            checkAns(userSeq.length - 1);
        }

        let allBtns = document.querySelectorAll(".btn");
        for (let btn of allBtns) {
            btn.addEventListener("click", btnPress);
        }

        function reset() {
            started = false;
            gameSeq = [];
            userSeq = [];
            level = 0;
            updateScore();
        }
    </script>
</body>
</html>
